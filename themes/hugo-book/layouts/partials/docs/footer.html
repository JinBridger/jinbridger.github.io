{{ $script := resources.Get "clipboard.js" | resources.Minify }}
{{ with $script.Content }}
  <script>{{ . | safeJS }}</script>

<script>
  function setGiscusTheme(theme) {
    const iframe = document.querySelector('iframe.giscus-frame');
    if (!iframe) return;
    iframe.contentWindow.postMessage(
      {
        giscus: {
          setConfig: {
            theme: theme
          }
        }
      },
      'https://giscus.app'
    );
  }

  function setSvgTheme(theme) {
    const imgs = document.querySelectorAll('img[id$="auto_svg"]');

    imgs.forEach(img => {
      if (!img.dataset.baseSrc) {
        // 第一次调用时保存初始 src
        // 去掉可能已有的 -dark/-light 后缀
        img.dataset.baseSrc = img.src.replace(/-(dark|light)(?=\.svg$)/, '');
      }

      // 拼接新路径
      const newSrc = img.dataset.baseSrc.replace(/\.svg$/, `-${theme}.svg`);
      img.src = newSrc;
    });
  }

  function toggleTheme() {
    let current = document.documentElement.getAttribute("data-theme");
    let newTheme;
    if (current === "dark") {
      newTheme = "light";
    } else {
      newTheme = "dark";
    }
    document.documentElement.setAttribute("data-theme", newTheme);
    localStorage.setItem("theme", newTheme);
    updateButton(newTheme === "dark");

    setGiscusTheme(newTheme);
    setSvgTheme(newTheme);
  }

  const theme = localStorage.getItem("theme");
  if (theme) {
    document.documentElement.setAttribute("data-theme", theme);
    setSvgTheme(theme);
  }

  updateButton(theme === "dark");
</script>

<script src="https://giscus.app/client.js"
  data-repo="JinBridger/site-blog-comments"
  data-repo-id="R_kgDOLMiN3w"
  data-category="Announcements"
  data-category-id="DIC_kwDOLMiN384Cc3hB"
  data-mapping="pathname"
  data-strict="0"
  data-reactions-enabled="1"
  data-emit-metadata="0"
  data-input-position="bottom"
  data-theme="preferred_color_scheme"
  data-lang="zh-CN"
  data-loading="lazy"
  crossorigin="anonymous"
  async>
</script>

{{ end }}
